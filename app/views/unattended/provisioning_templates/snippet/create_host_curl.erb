<%#
kind: snippet
name: create_host_curl
model: ProvisioningTemplate
snippet: true
-%>
<%#
  Creates host via CURL request.
  Parameters:
  - :headers [Array]
  - :organization
  - :location
  - :hostgroup
-%>
HOSTNAME=$(hostname -f)

curl -X POST <%= foreman_server_url %>/api/hosts \
      <%= @headers.join(' ') if @headers.any? %> \
      -d '{ "host": { "name": "'$HOSTNAME'", "build": "false", "managed": "false"
      <%= ", \"organization_id\": \"#{@organization.id}\"" if @organization %>
      <%= ", \"location_id\": \"#{@location.id}\"" if @location %>
      <%= ", \"hostgroup_id\": \"#{@hostgroup.id}\"" if @hostgroup %>
      }}'
